<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‰¾æ¢ç´¢-æå…‰é¢„æŠ¥</title>
  <meta name="description" content="æ å…‰ å® æ—¶ é¢„ æŠ¥">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            aurora: {
              blue: '#4096ff',
              green: '#52c41a',
              orange: '#fa8c16',
              red: '#f5222d',
              purple: '#722ed1',
              pink: '#ff4d4f',
              dark: '#141414'
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      }
      .text-shadow-heavy {
        text-shadow: 0 1px 3px rgba(0,0,0,0.9), 0 0 2px rgba(0,0,0,0.7);
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.15);
      }
      .live-pulse {
        animation: pulse 4s infinite;
      }
      .warning-pulse {
        animation: warning 4s infinite;
      }
      .region-high {
        animation: region-high 3s infinite;
      }
      .region-warning {
        animation: region 3s infinite;
      }
      .breathing {
        animation: breathing 3s infinite;
      }
     
      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.6; }
        100% { opacity: 1; }
      }
      @keyframes warning {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.05); }
        100% { opacity: 1; transform: scale(1); }
      }
      @keyframes region {
        0% { box-shadow: 0 0 5px rgba(250, 140, 22, 0); }
        50% { box-shadow: 0 0 15px rgba(250, 140, 22, 0.8); }
        100% { box-shadow: 0 0 5px rgba(250, 140, 22, 0); }
      }
      @keyframes region-high {
        0% { box-shadow: 0 0 5px rgba(245, 34, 45, 0); }
        50% { box-shadow: 0 0 20px rgba(245, 34, 45, 0.9); }
        100% { box-shadow: 0 0 5px rgba(245, 34, 45, 0); }
      }
      @keyframes breathing {
        0% { opacity: 0.3; }
        50% { opacity: 1; }
        100% { opacity: 0.3; }
      }
    }
  </style>
</head>
<body class="bg-transparent overflow-x-hidden">
  <div class="min-h-screen bg-gradient-to-br from-gray-900 to-blue-900 p-4">

    <div class="glass-effect rounded-2xl p-4 mb-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <div class="w-12 h-12 bg-gradient-to-r from-aurora-blue to-aurora-purple rounded-full flex items-center justify-center mr-3">
            <i class="fa fa-bolt text-white text-lg"></i>
          </div>
          <div>
            <div class="text-white font-bold text-shadow">è‰¾æ¢ç´¢-æå…‰é¢„æŠ¥</div>
            <div id="datetime" class="text-white text-sm text-shadow-heavy">2025/09/30 12:34:56</div>
          </div>
        </div>
        
        <div class="flex items-center space-x-2">
          <span class="inline-flex items-center justify-center w-8 h-8 bg-aurora-pink rounded-full live-pulse">
            <i class="fa fa-circle text-[8px] text-white"></i>
          </span>
          <div id="kp-display" class="text-aurora-orange font-bold text-shadow">KP: --</div>
        </div>
      </div>
    </div>

    <div id="warning-text" class="glass-effect rounded-xl p-3 mb-4 text-center warning-pulse">
      <div class="text-white text-base font-bold text-shadow-heavy">
        æ­£åœ¨è¿æ¥æ•°æ®æº...
      </div>
    </div>

    <div class="glass-effect rounded-2xl p-4 mb-4">
      <div class="flex items-center justify-center mb-3">
        <i class="fa fa-bolt text-aurora-green mr-2" id="wind-speed-icon"></i>
        <span id="forecast-title" class="font-bold text-white text-lg text-shadow">åˆå§‹åŒ–ä¸­...</span>
      </div>

      <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="text-center">
          <div class="text-aurora-blue text-sm">å¤ªé˜³é£é€Ÿ</div>
          <div id="solar-wind" class="text-white font-bold">-- km/s</div>
        </div>
        <div class="text-center">
          <div class="text-aurora-green text-sm">HPIå¼ºåº¦</div>
          <div id="hpi-power" class="text-white font-bold">--</div>
        </div>
        <div class="text-center">
          <div class="text-aurora-purple text-sm">Bzæ–¹å‘</div>
          <div id="bz-direction" class="text-white font-bold">-- nT</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-2 text-xs text-gray-300">
        <div>æ•°æ®çŠ¶æ€: <span id="data-status">è¿æ¥ä¸­...</span></div>
        <div>æ›´æ–°æ—¶é—´: <span id="last-update">--</span></div>
      </div>
    </div>

    <div class="glass-effect rounded-2xl p-4 mb-4">
      <div class="flex items-center justify-between mb-3">
        <div class="text-white font-bold text-shadow-heavy">å®æ—¶ç›‘æ§ç”»é¢</div>
        <div class="flex items-center">
          <div class="w-3 h-3 bg-aurora-green rounded-full breathing mr-2"></div>
          <div class="text-white text-xs" id="live-location">åŒ—</div>
        </div>
      </div>
      <div class="relative bg-black rounded-xl overflow-hidden">
        <div id="live-camera" class="aspect-video bg-cover bg-center bg-no-repeat flex items-center justify-center" style="background-image: url('https://pics.starvisor.net/galleries/orig/cap_bag.jpg')">
          <div id="camera-placeholder" class="absolute inset-0 bg-gradient-to-br from-purple-900 to-blue-800 flex items-center justify-center">
            <div class="text-center text-white">
              <i class="fa fa-video-camera text-4xl mb-2 opacity-50"></i>
              <div class="text-sm">æå…‰å®æ—¶ç›‘æ§ç”»é¢</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-4">
      <div class="flex items-center justify-between mb-3">
        <div class="text-white font-bold text-shadow-heavy">è§‚æµ‹åœ°ç‚¹é¢„æŠ¥</div>
      </div>
      
      <div class="space-y-4">
        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-arctic">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">åŒ—ææ‘</div>
              <div id="arctic-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="arctic-cloud">äº‘é‡: --%</div>
              <div id="arctic-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="arctic-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="arctic-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-mangui">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">æ»¡å½’é•‡</div>
              <div id="mangui-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="mangui-cloud">äº‘é‡: --%</div>
              <div id="mangui-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div
          <div id="mangui-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="mangui-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-genhe">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">æ ¹æ²³å¸‚</div>
              <div id="genhe-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="genhe-cloud">äº‘é‡: --%</div>
              <div id="genhe-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="genhe-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="genhe-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-eerguna">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">é¢å°”å¤çº³</div>
              <div id="eerguna-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="eerguna-cloud">äº‘é‡: --%</div>
              <div id="eerguna-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="eerguna-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="eerguna-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-heihe">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">é»‘æ²³å¸‚</div>
              <div id="heihe-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="heihe-cloud">äº‘é‡: --%</div>
              <div id="heihe-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="heihe-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="heihe-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-hegu">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">ç¦¾æœ¨æ‘</div>
              <div id="hegu-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="hegu-cloud">äº‘é‡: --%</div>
              <div id="hegu-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="hegu-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="hegu-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-hailar">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">æµ·æ‹‰å°”</div>
              <div id="hailar-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="hailar-cloud">äº‘é‡: --%</div>
              <div id="hailar-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="hailar-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="hailar-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>

        <div class="region-container glass-effect rounded-2xl overflow-hidden" id="city-zalantun">
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="text-white text-xl font-bold text-shadow-heavy">æ‰å…°å±¯</div>
              <div id="zalantun-prob" class="text-aurora-green text-xl font-bold">æ¦‚ç‡: --%</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-white text-sm">
              <div id="zalantun-cloud">äº‘é‡: --%</div>
              <div id="zalantun-temp">æ¸©åº¦: --Â°C</div>
            </div>
          </div>
          <div id="zalantun-shooting-tips" class="bg-aurora-green/20 p-3 border-t border-white/10 hidden">
            <div class="text-white text-sm font-bold mb-1">æ‹æ‘„å‚æ•°:</div>
            <div class="text-white text-xs" id="zalantun-params">ç­‰å¾…æ•°æ®...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center text-gray-400 text-xs mt-4 pb-4">
      <div>å…¬ä¼—å·:æå…‰é¢„æŠ¥-å°çº¢ä¹¦ï¼šè‰¾æ¢ç´¢è¿½æå…‰ Â© 2025</div>
    </div>
  </div>

  <script>

(function() {
    'use strict';
    
    const AuroraConfig = {
        anchorLocation: {
            name: "starvisor",
            lat: 53.5,
            lon: 122.3,
            timezone: "Asia/Shanghai"
        },
        
        locations: {
            arctic: { 
                name: "åŒ—ææ‘", 
                lat: 53.5, 
                lon: 122.3, 
                factor: 1.25,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-2000ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            heihe: { 
                name: "é»‘æ²³å¸‚", 
                lat: 50.2, 
                lon: 127.5, 
                factor: 1.18,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-2000ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            mangui: { 
                name: "æ»¡å½’é•‡", 
                lat: 52.0, 
                lon: 122.0, 
                factor: 1.15,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-2000ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            genhe: { 
                name: "æ ¹æ²³å¸‚", 
                lat: 50.8, 
                lon: 121.5, 
                factor: 1.15,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 1600-3200ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            eerguna: { 
                name: "é¢å°”å¤çº³", 
                lat: 50.2, 
                lon: 120.2, 
                factor: 1.08,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 1600-3200ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            hegu: { 
                name: "ç¦¾æœ¨æ‘", 
                lat: 48.5, 
                lon: 87.4, 
                factor: 0.85,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 1600-3200ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            hailar: { 
                name: "æµ·æ‹‰å°”", 
                lat: 49.2, 
                lon: 119.7, 
                factor: 1.05,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 1600-3200ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            },
            zalantun: { 
                name: "æ‰å…°å±¯", 
                lat: 48.0, 
                lon: 122.7, 
                factor: 0.90,
                shootingParams: {
                    low: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 800-1600ï¼Œå¿«é—¨10-20ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œ",
                    medium: "ä½¿ç”¨ä¸‰è„šæ¶ï¼ŒISO 1600-3200ï¼Œå¿«é—¨15-25ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼",
                    high: "ä½¿ç”¨ç¨³å›ºä¸‰è„šæ¶ï¼ŒISO 3200-6400ï¼Œå¿«é—¨20-30ç§’ï¼Œæ‰‹åŠ¨å¯¹ç„¦æ— é™è¿œï¼Œå¼€å¯RAWæ ¼å¼ï¼Œä½¿ç”¨é¥æ§å¿«é—¨"
                }
            }
        },
        
        thresholds: {
            probability: {
                low: 30,
                medium: 50,
                high: 80
            },
            cloudCover: {
                low: 30,
                medium: 70
            },
            temperature: {
                cold: -20,
                medium: -10
            },
            windSpeed: {
                medium: 500,
                high: 600,
                min: 300,
                credible: 400
            },
            hpi: {
                min: 20,
                credible: 25
            },
            bz: {
                min: -5,
                credible: -10
            },
            density: {
                min: 2,
                credible: 3
            },
            bt: {
                min: 3,
                credible: 4
            }
        },
        
        liveCameraUrl: "https://pics.starvisor.net/galleries/orig/cap_bag.jpg",
        auroraRefresh: 2 * 60 * 1000,
        weatherRefresh: 10 * 60 * 1000
    };

    const AppState = {
        kpIndex: "--",
        forecastTime: "--",
        globalProb: 0,
        lastUpdate: null,
        hpiPower: 0,
        bzDirection: 0,
        solarWind: 0,
        solarDensity: 0,
        dataStatus: "æ­£åœ¨è¿æ¥...",
        dataCredible: true,
        shootingTime: "--",
        weatherCache: {}
    };

    const DomRefs = {
        forecastTitle: document.getElementById('forecast-title'),
        datetime: document.getElementById('datetime'),
        liveLocation: document.getElementById('live-location'),
        warningText: document.getElementById('warning-text'),
        windSpeedIcon: document.getElementById('wind-speed-icon'),
        kpDisplay: document.getElementById('kp-display'),
        lastUpdate: document.getElementById('last-update'),
        solarWind: document.getElementById('solar-wind'),
        hpiPower: document.getElementById('hpi-power'),
        bzDirection: document.getElementById('bz-direction'),
        dataStatus: document.getElementById('data-status'),
        liveCamera: document.getElementById('live-camera'),
        cameraPlaceholder: document.getElementById('camera-placeholder'),
        cities: {
            arctic: {
                container: document.getElementById('city-arctic'),
                prob: document.getElementById('arctic-prob'),
                cloud: document.getElementById('arctic-cloud'),
                temp: document.getElementById('arctic-temp'),
                tips: document.getElementById('arctic-shooting-tips'),
                params: document.getElementById('arctic-params')
            },
            mangui: {
                container: document.getElementById('city-mangui'),
                prob: document.getElementById('mangui-prob'),
                cloud: document.getElementById('mangui-cloud'),
                temp: document.getElementById('mangui-temp'),
                tips: document.getElementById('mangui-shooting-tips'),
                params: document.getElementById('mangui-params')
            },
            genhe: {
                container: document.getElementById('city-genhe'),
                prob: document.getElementById('genhe-prob'),
                cloud: document.getElementById('genhe-cloud'),
                temp: document.getElementById('genhe-temp'),
                tips: document.getElementById('genhe-shooting-tips'),
                params: document.getElementById('genhe-params')
            },
            eerguna: {
                container: document.getElementById('city-eerguna'),
                prob: document.getElementById('eerguna-prob'),
                cloud: document.getElementById('eerguna-cloud'),
                temp: document.getElementById('eerguna-temp'),
                tips: document.getElementById('eerguna-shooting-tips'),
                params: document.getElementById('eerguna-params')
            },
            heihe: {
                container: document.getElementById('city-heihe'),
                prob: document.getElementById('heihe-prob'),
                cloud: document.getElementById('heihe-cloud'),
                temp: document.getElementById('heihe-temp'),
                tips: document.getElementById('heihe-shooting-tips'),
                params: document.getElementById('heihe-params')
            },
            hegu: {
                container: document.getElementById('city-hegu'),
                prob: document.getElementById('hegu-prob'),
                cloud: document.getElementById('hegu-cloud'),
                temp: document.getElementById('hegu-temp'),
                tips: document.getElementById('hegu-shooting-tips'),
                params: document.getElementById('hegu-params')
            },
            hailar: {
                container: document.getElementById('city-hailar'),
                prob: document.getElementById('hailar-prob'),
                cloud: document.getElementById('hailar-cloud'),
                temp: document.getElementById('hailar-temp'),
                tips: document.getElementById('hailar-shooting-tips'),
                params: document.getElementById('hailar-params')
            },
            zalantun: {
                container: document.getElementById('city-zalantun'),
                prob: document.getElementById('zalantun-prob'),
                cloud: document.getElementById('zalantun-cloud'),
                temp: document.getElementById('zalantun-temp'),
                tips: document.getElementById('zalantun-shooting-tips'),
                params: document.getElementById('zalantun-params')
            }
        }
    };

    function clearClasses(element) {
        if (element) element.className = '';
    }
    
    function getProbColor(probability) {
        if (probability >= AuroraConfig.thresholds.probability.high) {
            return 'text-aurora-red';
        } else if (probability >= AuroraConfig.thresholds.probability.medium) {
            return 'text-aurora-orange';
        } else if (probability >= AuroraConfig.thresholds.probability.low) {
            return 'text-aurora-green';
        } else {
            return 'text-gray-400';
        }
    }
    
    function getCloudColor(cloudCover) {
        if (cloudCover >= AuroraConfig.thresholds.cloudCover.medium) {
            return 'text-aurora-red';
        } else if (cloudCover >= AuroraConfig.thresholds.cloudCover.low) {
            return 'text-aurora-orange';
        } else {
            return 'text-aurora-green';
        }
    }
    
    function getTempColor(temperature) {
        if (temperature <= AuroraConfig.thresholds.temperature.cold) {
            return 'text-aurora-blue';
        } else if (temperature <= AuroraConfig.thresholds.temperature.medium) {
            return 'text-aurora-purple';
        } else {
            return 'text-white';
        }
    }
    
    function getWindColor(speed) {
        if (speed >= AuroraConfig.thresholds.windSpeed.high) {
            return 'text-aurora-red';
        } else if (speed >= AuroraConfig.thresholds.windSpeed.medium) {
            return 'text-aurora-orange';
        } else {
            return 'text-aurora-green';
        }
    }

    function checkCameraImage() {
        const img = new Image();
        img.onload = function() {
            if (DomRefs.cameraPlaceholder) {
                DomRefs.cameraPlaceholder.style.display = 'none';
            }
        };
        img.onerror = function() {
            if (DomRefs.cameraPlaceholder) {
                DomRefs.cameraPlaceholder.style.display = 'flex';
            }
        };
        img.src = AuroraConfig.liveCameraUrl + '?' + new Date().getTime();
    }

    function isDataValid() {
        const t = AuroraConfig.thresholds;
        
        if (AppState.solarWind < t.windSpeed.min) return false;
        if (AppState.hpiPower < t.hpi.min) return false;
        if (AppState.bzDirection > t.bz.min) return false;
        if (AppState.solarDensity < t.density.min) return false;
        if (parseFloat(AppState.kpIndex) < t.bt.min) return false;
        
        return true;
    }

    function calcShootTime() {
        if (!AppState.forecastTime || AppState.forecastTime === "--") return "--";
        
        const now = new Date();
        const shootTime = new Date(now.getTime() + AppState.forecastTime * 60 * 1000);
        
        const hours = String(shootTime.getHours()).padStart(2, '0');
        const minutes = String(shootTime.getMinutes()).padStart(2, '0');
        
        return `${hours}:${minutes}`;
    }

    function updateCameraTips() {
        for (const [key, loc] of Object.entries(AuroraConfig.locations)) {
            const city = DomRefs.cities[key];
            if (!city || !city.tips) continue;
            
            const actualProb = AppState.dataCredible ? calcAuroraProb(
                AppState.hpiPower || 0,
                AppState.bzDirection || 0,
                AppState.solarWind || 0,
                AppState.solarDensity || 0,
                loc.factor
            ) : 0;
            
            if (!AppState.dataCredible || actualProb < AuroraConfig.thresholds.probability.low) {
                city.tips.classList.add('hidden');
            } else {
                city.tips.classList.remove('hidden');
                
                let paramsText = "";
                if (actualProb >= AuroraConfig.thresholds.probability.high) {
                    paramsText = loc.shootingParams.high;
                    city.tips.className = city.tips.className.replace(/bg-[^ ]*/g, '') + ' bg-aurora-red/20';
                } else if (actualProb >= AuroraConfig.thresholds.probability.medium) {
                    paramsText = loc.shootingParams.medium;
                    city.tips.className = city.tips.className.replace(/bg-[^ ]*/g, '') + ' bg-aurora-orange/20';
                } else {
                    paramsText = loc.shootingParams.low;
                    city.tips.className = city.tips.className.replace(/bg-[^ ]*/g, '') + ' bg-aurora-green/20';
                }
                
                const cloudText = city.cloud.textContent;
                const cloudMatch = cloudText.match(/\d+/);
                if (cloudMatch) {
                    const cloudValue = parseInt(cloudMatch[0]);
                    if (cloudValue > 50) {
                        paramsText += " âš ï¸åŒ—è¾¹äº‘é‡" + cloudValue + "%ï¼Œå¯èƒ½å½±å“è§‚æµ‹";
                    } else if (cloudValue > 30) {
                        paramsText += " âš ï¸æ³¨æ„åŒ—è¾¹äº‘é‡å˜åŒ–";
                    }
                }
                
                city.params.textContent = paramsText;
            }
        }
    }

    function updateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        DomRefs.datetime.innerHTML = `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
    }

    function calcAuroraProb(hpi, bz, wind, density, locationFactor) {
        if (!isDataValid()) return 0;
        
        let probability = 0;
        const t = AuroraConfig.thresholds;
        const duration = AppState.forecastTime || 30;

        if (hpi >= 90) probability += 35;
        else if (hpi >= 70) probability += 25;
        else if (hpi >= 50) probability += 15;
        else if (hpi >= t.hpi.credible) probability += 10;

        if (bz < -15) probability += 30;
        else if (bz < -10) probability += 20;
        else if (bz < t.bz.credible) probability += 10;

        if (wind >= 750) probability += 20;
        else if (wind >= 600) probability += 15;
        else if (wind >= 500) probability += 10;
        else if (wind >= t.windSpeed.credible) probability += 5;

        if (density >= 10) probability += 5;
        else if (density >= 5) probability += 3;
        else if (density >= t.density.credible) probability += 2;
        else probability += Math.min(1, density);

        if (duration >= 60) probability += 15;
        else if (duration >= 45) probability += 10;
        else if (duration >= 30) probability += 7;
        else if (duration >= 15) probability += 3;

        probability *= locationFactor;

        return Math.min(95, Math.max(0, probability));
    }

    function updateAllProbabilities() {
        if (AppState.kpIndex === "--") return;
        
        AppState.dataCredible = isDataValid();
        AppState.shootingTime = calcShootTime();
        
        for (const [key, loc] of Object.entries(AuroraConfig.locations)) {
            const actualProb = AppState.dataCredible ? calcAuroraProb(
                AppState.hpiPower || 0,
                AppState.bzDirection || 0,
                AppState.solarWind || 0,
                AppState.solarDensity || 0,
                loc.factor
            ) : 0;
            
            const city = DomRefs.cities[key];
            if (!city || !city.prob) continue;
            
            let probText;
            if (!AppState.dataCredible) {
                probText = "æ¦‚ç‡: æ— æå…‰";
            } else if (actualProb < AuroraConfig.thresholds.probability.low) {
                probText = "æ¦‚ç‡: å¯èƒ½å¾®å¼±æå…‰";
            } else {
                probText = `æ¦‚ç‡: ${Math.round(actualProb)}%`;
            }
            
            city.prob.textContent = probText;
            clearClasses(city.prob);
            city.prob.className = `text-xl font-bold ${getProbColor(actualProb)} text-shadow-heavy`;
            
            clearClasses(city.container);
            city.container.className = 'region-container glass-effect rounded-2xl overflow-hidden';
            
            if (!AppState.dataCredible) {
                city.container.style.opacity = '0.6';
            } else {
                city.container.style.opacity = '1';
                if (actualProb >= AuroraConfig.thresholds.probability.high) {
                    city.container.classList.add('region-high');
                } else if (actualProb >= AuroraConfig.thresholds.probability.medium) {
                    city.container.classList.add('region-warning');
                }
            }
        }
        
        if (!AppState.dataCredible) {
            AppState.globalProb = 0;
        } else {
            let totalProb = 0;
            let count = 0;
            for (const [key, loc] of Object.entries(AuroraConfig.locations)) {
                const prob = calcAuroraProb(
                    AppState.hpiPower || 0,
                    AppState.bzDirection || 0,
                    AppState.solarWind || 0,
                    AppState.solarDensity || 0,
                    loc.factor
                );
                totalProb += prob;
                count++;
            }
            AppState.globalProb = Math.round(totalProb / count);
        }
        
        DomRefs.kpDisplay.textContent = `KP: ${AppState.kpIndex}`;
        
        if (AppState.forecastTime !== "--") {
            const timeText = AppState.dataCredible && AppState.shootingTime !== "--" 
                ? `${AppState.forecastTime}åˆ†é’Ÿå(${AppState.shootingTime}æ—¶)æå…‰é¢„æŠ¥`
                : `${AppState.forecastTime}åˆ†é’Ÿåæå…‰é¢„æŠ¥`;
            
            DomRefs.forecastTitle.textContent = timeText;
            
            clearClasses(DomRefs.forecastTitle);
            DomRefs.forecastTitle.className = `font-bold text-lg ${getWindColor(AppState.solarWind)} text-shadow`;
            
            clearClasses(DomRefs.windSpeedIcon);
            DomRefs.windSpeedIcon.className = `fa fa-bolt mr-2 ${getWindColor(AppState.solarWind)}`;
        }
        
        updateAlertText();
        updateCameraTips();
    }

    function updateAlertText() {
        let text = "";
        let textColor = "text-white";
        
        if (!AppState.dataCredible) {
            text = "âŒ é¢„æŠ¥é€šçŸ¥ï¼šå›½å†…ç©ºé—´å¤©æ°”å¹³é™ï¼Œæ— è¶³å¤Ÿå¼ºåº¦çš„å¤ªé˜³é£é©±åŠ¨æå…‰äº§ç”Ÿï¼å› æ­¤å½“å‰æ‹æ‘„åˆ°çš„å¸¦è‰²å½©çš„å¤œç©ºç”»é¢ï¼Œä»¥æ°”è¾‰ä¸ºä¸» â€”â€” ç§‘æ™®ï¼šæ°”è¾‰æœ¬å°±æ˜¯é«˜å±‚å¤§æ°” 'é»˜é»˜å‘å…‰' çš„å¸¸æ€ç°è±¡ã€‚";
            textColor = "text-gray-400";
        } else if (AppState.globalProb >= AuroraConfig.thresholds.probability.high) {
            text = `ğŸ”¥ æå…‰å¼ºé¢„è­¦ï¼šç»¼åˆæ¦‚ç‡${AppState.globalProb}%ï¼Œå»ºè®®${AppState.shootingTime}æ—¶åœ¨å…‰æ±¡æŸ“ç­‰çº§â‰¤2çº§åœ°åŒºè§‚æµ‹`;
            textColor = "text-aurora-red";
        } else if (AppState.globalProb >= AuroraConfig.thresholds.probability.medium) {
            text = `âš ï¸ æå…‰é¢„è­¦ï¼šç»¼åˆæ¦‚ç‡${AppState.globalProb}%ï¼Œå»ºè®®${AppState.shootingTime}æ—¶åœ¨æš—ç©ºç¯å¢ƒå°è¯•æ‹æ‘„`;
            textColor = "text-aurora-orange";
        } else if (AppState.globalProb >= AuroraConfig.thresholds.probability.low) {
            text = `ğŸ“· æå…‰è§‚æµ‹æç¤ºï¼šç»¼åˆæ¦‚ç‡${AppState.globalProb}%ï¼Œ${AppState.shootingTime}æ—¶å¯åœ¨æš—ç©ºç¯å¢ƒå°è¯•æ‹æ‘„`;
            textColor = "text-aurora-green";
        } else {
            text = "å½“å‰æ— æå…‰é¢„è­¦ä¿¡æ¯";
            textColor = "text-gray-300";
        }
        
        DomRefs.warningText.textContent = text;
        
        clearClasses(DomRefs.warningText);
        if (AppState.dataCredible && AppState.globalProb >= AuroraConfig.thresholds.probability.high) {
            DomRefs.warningText.className = `${textColor} text-base font-bold text-center warning-pulse text-shadow-heavy`;
        } else if (AppState.dataCredible && AppState.globalProb >= AuroraConfig.thresholds.probability.medium) {
            DomRefs.warningText.className = `${textColor} text-base font-bold text-center warning-pulse text-shadow-heavy`;
        } else {
            DomRefs.warningText.className = `${textColor} text-base font-bold text-center text-shadow-heavy`;
        }
    }

    function updateWeatherColors() {
        for (const [key, city] of Object.entries(DomRefs.cities)) {
            if (city.cloud) {
                const cloudText = city.cloud.textContent;
                const cloudMatch = cloudText.match(/\d+/);
                if (cloudMatch) {
                    const cloudValue = parseInt(cloudMatch[0]);
                    clearClasses(city.cloud);
                    city.cloud.className = `text-sm font-medium ${getCloudColor(cloudValue)} text-shadow-heavy`;
                }
            }
            
            if (city.temp) {
                const tempText = city.temp.textContent;
                const tempMatch = tempText.match(/-?\d+/);
                if (tempMatch) {
                    const tempValue = parseInt(tempMatch[0]);
                    clearClasses(city.temp);
                    city.temp.className = `text-sm font-medium ${getTempColor(tempValue)} text-shadow-heavy`;
                }
            }
        }
    }

    function refreshDisplay() {
        DomRefs.liveLocation.textContent = AuroraConfig.anchorLocation.name;
        updateAllProbabilities();
        updateWeatherColors();
        
        if (DomRefs.solarWind) DomRefs.solarWind.textContent = `${AppState.solarWind} km/s`;
        if (DomRefs.hpiPower) DomRefs.hpiPower.textContent = AppState.hpiPower;
        if (DomRefs.bzDirection) DomRefs.bzDirection.textContent = `${AppState.bzDirection} nT`;
        
        let statusText = AppState.dataStatus;
        if (!AppState.dataCredible) statusText += " (æ¡ä»¶ä¸ä½³)";
        if (DomRefs.dataStatus) DomRefs.dataStatus.textContent = statusText;
        if (DomRefs.lastUpdate) DomRefs.lastUpdate.textContent = AppState.lastUpdate || "--";
    }

    async function getAuroraData() {
        try {
            AppState.dataStatus = "æ­£åœ¨è·å–æ•°æ®...";
            refreshDisplay();

            try {
                const kpRes = await fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json');
                if (!kpRes.ok) throw new Error(`HTTP error! status: ${kpRes.status}`);
                const kpData = await kpRes.json();
                if (kpData && kpData.length > 0) {
                    const latestKp = kpData[kpData.length - 1];
                    AppState.kpIndex = latestKp.estimated_kp?.toFixed(1) || "--";
                }
            } catch (e) {
                console.warn("KPæŒ‡æ•°è·å–å¤±è´¥", e);
                AppState.kpIndex = "--";
            }

            try {
                const plasmaRes = await fetch('https://services.swpc.noaa.gov/products/solar-wind/plasma-2-hour.json');
                if (!plasmaRes.ok) throw new Error(`HTTP error! status: ${plasmaRes.status}`);
                const plasmaData = await plasmaRes.json();
                
                if (Array.isArray(plasmaData) && plasmaData.length > 1) {
                    const headers = plasmaData[0];
                    const speedIndex = headers.indexOf("speed");
                    const densityIndex = headers.indexOf("density");
                    
                    if (speedIndex !== -1 && densityIndex !== -1) {
                        const latest = plasmaData[plasmaData.length - 1];
                        AppState.solarWind = parseFloat(latest[speedIndex]) || 0;
                        AppState.solarDensity = parseFloat(latest[densityIndex]) || 0;
                        
                        const distanceKm = 1500000;
                        const delayMinutes = 2;
                        const arrivalTimeMinutes = Math.round((distanceKm / AppState.solarWind / 60) + delayMinutes);
                        AppState.forecastTime = arrivalTimeMinutes;
                    }
                }
            } catch (e) {
                console.warn("å¤ªé˜³é£æ•°æ®è·å–å¤±è´¥", e);
                AppState.solarWind = 0;
                AppState.solarDensity = 0;
            }

            try {
                const hpiRes = await fetch('https://services.swpc.noaa.gov/text/aurora-nowcast-hemi-power.txt');
                if (!hpiRes.ok) throw new Error(`HTTP error! status: ${hpiRes.status}`);
                const hpiText = await hpiRes.text();
                const validLines = hpiText.trim().split("\n").filter(line => line.trim() && !line.startsWith("#"));
                if (validLines.length > 0) {
                    const lastLine = validLines[validLines.length - 1];
                    const columns = lastLine.split(/\s+/).filter(Boolean);
                    if (columns.length >= 3) AppState.hpiPower = parseFloat(columns[2]) || 0;
                }
            } catch (e) {
                console.warn("HPIå¼ºåº¦è·å–å¤±è´¥", e);
                AppState.hpiPower = 0;
            }

            try {
                const magRes = await fetch('https://services.swpc.noaa.gov/products/solar-wind/mag-2-hour.json');
                if (!magRes.ok) throw new Error(`HTTP error! status: ${magRes.status}`);
                const magData = await magRes.json();
                
                if (Array.isArray(magData) && magData.length > 1) {
                    const headers = magData[0];
                    const bzIndex = headers.indexOf("bz_gsm");
                    
                    if (bzIndex !== -1) {
                        const latest = magData[magData.length - 1];
                        AppState.bzDirection = latest[bzIndex] ? parseFloat(latest[bzIndex]) : 0;
                    }
                }
            } catch (e) {
                console.warn("Bzæ–¹å‘è·å–å¤±è´¥", e);
                AppState.bzDirection = 0;
            }
            
            AppState.dataStatus = "æ•°æ®æ­£å¸¸";
            AppState.lastUpdate = new Date().toLocaleTimeString();
            refreshDisplay();
            
        } catch (error) {
            console.error("æå…‰æ•°æ®è·å–é”™è¯¯:", error);
            AppState.dataStatus = "æ•°æ®è·å–å¤±è´¥";
            refreshDisplay();
        }
    }

    async function getWeatherData() {
        try {
            for (const [key, loc] of Object.entries(AuroraConfig.locations)) {
                try {
                    const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,cloud_cover&timezone=auto`;
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    
                    const city = DomRefs.cities[key];
                    
                    if (city && city.temp && data?.current?.temperature_2m !== undefined) {
                        const temp = Math.round(data.current.temperature_2m);
                        city.temp.textContent = `æ¸©åº¦: ${temp}Â°C`;
                        if (!AppState.weatherCache[key]) AppState.weatherCache[key] = {};
                        AppState.weatherCache[key].temp = temp;
                    }
                    
                    if (city && city.cloud && data?.current?.cloud_cover !== undefined) {
                        const cloud = data.current.cloud_cover;
                        city.cloud.textContent = `äº‘é‡: ${cloud}%`;
                        if (!AppState.weatherCache[key]) AppState.weatherCache[key] = {};
                        AppState.weatherCache[key].cloud = cloud;
                    }
                    
                } catch (e) {
                    console.warn(`${loc.name}å¤©æ°”è·å–å¤±è´¥`, e);
                    const city = DomRefs.cities[key];
                    const cache = AppState.weatherCache[key];
                    
                    if (city && city.temp) {
                        if (cache?.temp !== undefined) city.temp.textContent = `æ¸©åº¦: ${cache.temp}Â°C âš ï¸`;
                        else city.temp.textContent = `æ¸©åº¦: -- Â°C`;
                    }
                    
                    if (city && city.cloud) {
                        if (cache?.cloud !== undefined) city.cloud.textContent = `äº‘é‡: ${cache.cloud}% âš ï¸`;
                        else city.cloud.textContent = `äº‘é‡: -- %`;
                    }
                }
            }
            
            updateWeatherColors();
            
        } catch (error) {
            console.error("å¤©æ°”æ•°æ®è·å–é”™è¯¯:", error);
        }
    }

    function startApp() {
        updateTime();
        getAuroraData();
        getWeatherData();
        checkCameraImage();
        
        setInterval(getAuroraData, AuroraConfig.auroraRefresh);
        setInterval(getWeatherData, AuroraConfig.weatherRefresh);
        setInterval(updateTime, 1000);
        
        console.log("æå…‰è§‚æµ‹ç³»ç»Ÿå·²å¯åŠ¨");
    }

    document.addEventListener('DOMContentLoaded', startApp);
})();
</script>
